<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>äº”åéŸ³ç»ƒä¹  Â· ç§»åŠ¨ä¼˜åŒ–ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Noto Sans JP', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }

        .practice-container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: 24px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            border: 1px solid #e9ecef;
        }

        /* è¯åº“é€‰æ‹©å™¨åŒºåŸŸ - ç§»åŠ¨ç«¯ç´§å‡‘ */
        .selector-area {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            background-color: #f8f9fa;
            padding: 12px 16px;
            border-radius: 16px;
            border: 1px solid #e2e6ea;
        }

        .selector-label {
            font-size: 1rem;
            font-weight: 600;
            color: #1e3a5f;
            background-color: #e4ebf5;
            padding: 4px 14px;
            border-radius: 30px;
            white-space: nowrap;
        }

        .word-selector {
            flex: 1 1 160px;
            padding: 8px 12px;
            font-size: 1rem;
            border: 2px solid #ced4da;
            border-radius: 12px;
            background: white;
            font-weight: 500;
            color: #1e2a3a;
            outline: none;
        }

        /* æ˜¾ç¤ºåŒºï¼šå‡å + å€’è®¡æ—¶ - å‚ç›´æ’åˆ— */
        .display-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .kana-display {
            background-color: #f1f3f5;
            padding: 16px 24px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            font-size: 5rem;
            font-weight: 600;
            color: #212529;
            line-height: 1;
            min-width: 160px;
            text-align: center;
            font-family: 'Noto Serif JP', 'MS Mincho', serif;
            letter-spacing: 4px;
        }

        .timer-display {
            background-color: #2c3e50;
            color: #f1c40f;
            font-size: 2.5rem;
            font-weight: 800;
            padding: 10px 24px;
            border-radius: 20px;
            font-family: 'Courier New', monospace;
            border: 3px solid #f39c12;
            min-width: 120px;
            text-align: center;
        }

        /* è¾“å…¥åŒº */
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 6px;
            background-color: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid #e2e6ea;
        }

        .input-label {
            font-size: 1rem;
            font-weight: 600;
            color: #2b3a4a;
            margin-left: 4px;
        }

        .input-row {
            display: flex;
            flex-wrap: nowrap;  /* ç¦æ­¢æ¢è¡Œï¼Œä¿è¯åœ¨ä¸€è¡Œå†… */
            gap: 8px;
        }

        .romaji-input {
            flex: 1 1 120px;    /* ç¼©å°åŸºç¡€å®½åº¦ï¼Œè®©è¾“å…¥æ¡†æ›´çª„ */
            min-width: 100px;    /* ç¡®ä¿å¤ªå°æ—¶ä»æœ‰å¯ç‚¹å‡»åŒºåŸŸ */
            padding: 10px 12px;
            font-size: 1.3rem;
            border: 2px solid #ced4da;
            border-radius: 12px;
            background: white;
            text-align: center;
        }

        .confirm-btn {
            flex: 0 0 auto;
            padding: 10px 18px;  /* æŒ‰é’®ç¨å¾®ç¼©å° */
            font-size: 1.3rem;
        }

        .confirm-btn {
            flex: 0 0 auto;
            padding: 12px 20px;
            font-size: 1.4rem;
            background-color: #4c6ef5;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            border-bottom: 3px solid #364fc7;
        }

        /* ç»Ÿè®¡åŒº - å‚ç›´å †å  */
        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: #f8f9fa;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid #e9ecef;
        }

        .stats-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }

        .result-area {
            font-size: 1.3rem;
            font-weight: 600;
            padding: 6px 16px;
            background-color: white;
            border-radius: 40px;
            border: 1px solid #dee2e6;
        }

        .counter-area {
            display: flex;
            gap: 20px;
            font-size: 1.2rem;
            background-color: white;
            padding: 6px 18px;
            border-radius: 40px;
            border: 1px solid #dee2e6;
        }

        .counter-item {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .counter-num {
            font-size: 1.6rem;
            font-weight: 700;
        }

        .counter-item:nth-child(1) .counter-num { color: #0b5e3c; }
        .counter-item:nth-child(2) .counter-num { color: #b45b0f; }
        .counter-item:nth-child(3) .counter-num { color: #a12a2a; }

        .stats-right {
            text-align: right;
        }

        .end-btn {
            background-color: #e9ecef;
            border: 1px solid #b6c4d1;
            color: #2e4a6a;
            padding: 8px 22px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        /* åé¦ˆåŒº */
        .feedback-section {
            background-color: #f1f5f9;
            border-radius: 20px;
            padding: 18px;
            border: 1px solid #dbe4ee;
        }

        .feedback-header {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 12px;
            margin-bottom: 16px;
        }

        .feedback-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #1e3a5f;
            background-color: #e4ebf5;
            padding: 4px 16px;
            border-radius: 30px;
            align-self: flex-start;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .learn-btn, .clear-btn {
            background-color: #e9ecef;
            border: 1px solid #b6c4d1;
            color: #2e4a6a;
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
        }

        .feedback-list {
            max-height: 150px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .badge-error {
            background-color: #fff4e6;
            color: #3a2c1b;
            padding: 6px 16px;
            border-radius: 30px 8px 30px 8px;
            font-size: 1.1rem;
            border: 1px solid #ffc9a4;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .badge-error span {
            font-size: 0.8rem;
            background-color: #ffe8d4;
            padding: 2px 8px;
            border-radius: 30px;
        }

        /* å­¦ä¹ åŒº */
        .learning-section {
            margin-top: 16px;
            background-color: #ffffff;
            border-radius: 16px;
            padding: 16px;
            border: 2px dashed #b0c4de;
            display: none;
        }

        .learning-section.visible {
            display: block;
        }

        .learning-part {
            margin-bottom: 20px;
        }

        .part-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e3a5f;
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 4px;
            margin-bottom: 12px;
        }

        /* ç½‘æ ¼ï¼šç§»åŠ¨ç«¯é»˜è®¤1åˆ—ï¼Œç¨å¤§å±å¹•2åˆ— */
        .kana-rows {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        @media (min-width: 400px) {
            .kana-rows {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .kana-rows {
            display: grid;
            grid-template-columns: repeat(5, 1fr);  /* å›ºå®š5åˆ— */
            gap: 6px;  /* ç¼©å°é—´éš™ */
        }

        .kana-row {
            background-color: #f8fafc;
            border-radius: 8px;
            padding: 4px 2px;  /* ç¼©å°å†…è¾¹è· */
            display: flex;
            align-items: center;
            justify-content: space-around;
            border: 1px solid #d1d9e6;
            transition: background-color 0.2s;
        }

        .kana-row .hira {
            font-size: 1.2rem;  /* ç¼©å°å­—ä½“ */
            min-width: 28px;
        }

        .kana-row .kata {
            font-size: 1.2rem;
            min-width: 28px;
        }

        .kana-row .roma {
            font-size: 0.7rem;  /* ç¼©å°ç½—é©¬éŸ³å­—ä½“ */
            padding: 2px 4px;
            min-width: 35px;
            white-space: nowrap;
        }

/* ç§»é™¤åŸæœ‰çš„åª’ä½“æŸ¥è¯¢ï¼Œå› ä¸ºå›ºå®š5åˆ—ä¸å†éœ€è¦ */

        .guide-note {
            margin-top: 16px;
            color: #4f6f8f;
            font-size: 0.85rem;
            border-top: 1px dashed #bacad9;
            padding-top: 12px;
        }

        /* é’ˆå¯¹å°å±å¹•è°ƒæ•´å­—ä½“å¤§å° */
        @media (max-width: 380px) {
            .kana-display { font-size: 4rem; padding: 12px 16px; }
            .timer-display { font-size: 2rem; padding: 6px 16px; }
            .romaji-input { font-size: 1.2rem; }
            .confirm-btn { font-size: 1.2rem; padding: 10px 16px; }
            .counter-area { gap: 12px; }
            .counter-num { font-size: 1.4rem; }
        }
    </style>
</head>
<body>
    <div class="practice-container">
        <!-- è¯åº“é€‰æ‹©å™¨ -->
        <div class="selector-area">
            <span class="selector-label">ğŸ“š è¯åº“</span>
            <select class="word-selector" id="wordSelector">
                <option value="seion" selected>æ¸…éŸ³ (92å­—)</option>
                <option value="dakuon">æ¸…éŸ³ + æµŠéŸ³/åŠæµŠéŸ³ (150å­—)</option>
                <option value="youon">æ¸…éŸ³ + æµŠéŸ³ + æ‹—éŸ³ (210å­—)</option>
            </select>
        </div>

        <!-- æ˜¾ç¤ºåŒºï¼šå‡å + å€’è®¡æ—¶ (å‚ç›´æ’åˆ—) -->
        <div class="display-area">
            <div class="kana-display" id="kanaDisplay">ã‚</div>
            <div class="timer-display" id="timerDisplay">3s</div>
        </div>

        <!-- è¾“å…¥åŒº -->
        <div class="input-section">
            <div class="input-label">ğŸ”¤ è¾“å…¥ç½—é©¬éŸ³</div>
            <div class="input-row">
                <input type="text" class="romaji-input" id="romajiInput" placeholder="ä¾‹: a, ka, shi" autofocus>
                <button class="confirm-btn" id="confirmBtn">âœ“</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡åŒº (å‚ç›´) -->
        <div class="stats-panel">
            <div class="stats-left">
                <div class="result-area" id="resultMessage">âœ¨ è¾“å…¥ç½—é©¬éŸ³ âœ¨</div>
                <div class="counter-area">
                    <div class="counter-item">P <span class="counter-num" id="perfectCount">0</span></div>
                    <div class="counter-item">G <span class="counter-num" id="goodCount">0</span></div>
                    <div class="counter-item">B <span class="counter-num" id="badCount">0</span></div>
                </div>
            </div>
            <div class="stats-right">
                <button class="end-btn" id="endPracticeBtn">ğŸ“Š ç»“æŸç»ƒä¹ </button>
            </div>
        </div>

        <!-- åé¦ˆåŒº -->
        <div class="feedback-section">
            <div class="feedback-header">
                <span class="feedback-title">ğŸ“‹ é”™è¯¯è®°å½• Â· æ­£è§£</span>
                <div class="btn-group">
                    <button class="learn-btn" id="learnBtn">ğŸ“– å­¦ä¹ äº”åéŸ³</button>
                    <button class="clear-btn" id="clearFeedbackBtn">æ¸…ç©ºåˆ—è¡¨</button>
                </div>
            </div>
            <div class="feedback-list" id="feedbackList"></div>
            <div class="guide-note">
                â€» 3ç§’å†…æ­£ç¡® = P(å®Œç¾)ï¼Œè¶…æ—¶æ­£ç¡® = G(è‰¯å¥½)ï¼Œé”™è¯¯ = B<br>
                â€» æ”¯æŒå¤šç§ç½—é©¬éŸ³ Â· åˆ‡æ¢è¯åº“è‡ªåŠ¨é‡ç½®
            </div>
        </div>

        <!-- å­¦ä¹ åŒº -->
        <div class="learning-section" id="learningSection">
            <!-- æ¸…éŸ³éƒ¨åˆ† -->
            <div class="learning-part" id="seionPart"></div>
            <!-- æµŠéŸ³éƒ¨åˆ† -->
            <div class="learning-part" id="dakuonPart"></div>
            <!-- æ‹—éŸ³éƒ¨åˆ† -->
            <div class="learning-part" id="youonPart"></div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ---------- ğŸ“˜ åŸºç¡€æ•°æ® ----------
            const seionHiragana = [
                { char: 'ã‚', roma: ['a'] }, { char: 'ã„', roma: ['i'] }, { char: 'ã†', roma: ['u'] }, { char: 'ãˆ', roma: ['e'] }, { char: 'ãŠ', roma: ['o'] },
                { char: 'ã‹', roma: ['ka'] }, { char: 'ã', roma: ['ki'] }, { char: 'ã', roma: ['ku'] }, { char: 'ã‘', roma: ['ke'] }, { char: 'ã“', roma: ['ko'] },
                { char: 'ã•', roma: ['sa'] }, { char: 'ã—', roma: ['shi', 'si'] }, { char: 'ã™', roma: ['su'] }, { char: 'ã›', roma: ['se'] }, { char: 'ã', roma: ['so'] },
                { char: 'ãŸ', roma: ['ta'] }, { char: 'ã¡', roma: ['chi', 'ti'] }, { char: 'ã¤', roma: ['tsu', 'tu'] }, { char: 'ã¦', roma: ['te'] }, { char: 'ã¨', roma: ['to'] },
                { char: 'ãª', roma: ['na'] }, { char: 'ã«', roma: ['ni'] }, { char: 'ã¬', roma: ['nu'] }, { char: 'ã­', roma: ['ne'] }, { char: 'ã®', roma: ['no'] },
                { char: 'ã¯', roma: ['ha'] }, { char: 'ã²', roma: ['hi'] }, { char: 'ãµ', roma: ['fu', 'hu'] }, { char: 'ã¸', roma: ['he'] }, { char: 'ã»', roma: ['ho'] },
                { char: 'ã¾', roma: ['ma'] }, { char: 'ã¿', roma: ['mi'] }, { char: 'ã‚€', roma: ['mu'] }, { char: 'ã‚', roma: ['me'] }, { char: 'ã‚‚', roma: ['mo'] },
                { char: 'ã‚„', roma: ['ya'] }, { char: 'ã‚†', roma: ['yu'] }, { char: 'ã‚ˆ', roma: ['yo'] },
                { char: 'ã‚‰', roma: ['ra'] }, { char: 'ã‚Š', roma: ['ri'] }, { char: 'ã‚‹', roma: ['ru'] }, { char: 'ã‚Œ', roma: ['re'] }, { char: 'ã‚', roma: ['ro'] },
                { char: 'ã‚', roma: ['wa'] }, { char: 'ã‚’', roma: ['wo', 'o'] }, { char: 'ã‚“', roma: ['n', 'nn'] }
            ];
            const seionKatakana = [
                { char: 'ã‚¢', roma: ['a'] }, { char: 'ã‚¤', roma: ['i'] }, { char: 'ã‚¦', roma: ['u'] }, { char: 'ã‚¨', roma: ['e'] }, { char: 'ã‚ª', roma: ['o'] },
                { char: 'ã‚«', roma: ['ka'] }, { char: 'ã‚­', roma: ['ki'] }, { char: 'ã‚¯', roma: ['ku'] }, { char: 'ã‚±', roma: ['ke'] }, { char: 'ã‚³', roma: ['ko'] },
                { char: 'ã‚µ', roma: ['sa'] }, { char: 'ã‚·', roma: ['shi', 'si'] }, { char: 'ã‚¹', roma: ['su'] }, { char: 'ã‚»', roma: ['se'] }, { char: 'ã‚½', roma: ['so'] },
                { char: 'ã‚¿', roma: ['ta'] }, { char: 'ãƒ', roma: ['chi', 'ti'] }, { char: 'ãƒ„', roma: ['tsu', 'tu'] }, { char: 'ãƒ†', roma: ['te'] }, { char: 'ãƒˆ', roma: ['to'] },
                { char: 'ãƒŠ', roma: ['na'] }, { char: 'ãƒ‹', roma: ['ni'] }, { char: 'ãƒŒ', roma: ['nu'] }, { char: 'ãƒ', roma: ['ne'] }, { char: 'ãƒ', roma: ['no'] },
                { char: 'ãƒ', roma: ['ha'] }, { char: 'ãƒ’', roma: ['hi'] }, { char: 'ãƒ•', roma: ['fu', 'hu'] }, { char: 'ãƒ˜', roma: ['he'] }, { char: 'ãƒ›', roma: ['ho'] },
                { char: 'ãƒ', roma: ['ma'] }, { char: 'ãƒŸ', roma: ['mi'] }, { char: 'ãƒ ', roma: ['mu'] }, { char: 'ãƒ¡', roma: ['me'] }, { char: 'ãƒ¢', roma: ['mo'] },
                { char: 'ãƒ¤', roma: ['ya'] }, { char: 'ãƒ¦', roma: ['yu'] }, { char: 'ãƒ¨', roma: ['yo'] },
                { char: 'ãƒ©', roma: ['ra'] }, { char: 'ãƒª', roma: ['ri'] }, { char: 'ãƒ«', roma: ['ru'] }, { char: 'ãƒ¬', roma: ['re'] }, { char: 'ãƒ­', roma: ['ro'] },
                { char: 'ãƒ¯', roma: ['wa'] }, { char: 'ãƒ²', roma: ['wo', 'o'] }, { char: 'ãƒ³', roma: ['n', 'nn'] }
            ];

            const dakuonHiragana = [
                { char: 'ãŒ', roma: ['ga'] }, { char: 'ã', roma: ['gi'] }, { char: 'ã', roma: ['gu'] }, { char: 'ã’', roma: ['ge'] }, { char: 'ã”', roma: ['go'] },
                { char: 'ã–', roma: ['za'] }, { char: 'ã˜', roma: ['ji', 'zi'] }, { char: 'ãš', roma: ['zu'] }, { char: 'ãœ', roma: ['ze'] }, { char: 'ã', roma: ['zo'] },
                { char: 'ã ', roma: ['da'] }, { char: 'ã¢', roma: ['ji', 'di'] }, { char: 'ã¥', roma: ['zu', 'du'] }, { char: 'ã§', roma: ['de'] }, { char: 'ã©', roma: ['do'] },
                { char: 'ã°', roma: ['ba'] }, { char: 'ã³', roma: ['bi'] }, { char: 'ã¶', roma: ['bu'] }, { char: 'ã¹', roma: ['be'] }, { char: 'ã¼', roma: ['bo'] },
                { char: 'ã±', roma: ['pa'] }, { char: 'ã´', roma: ['pi'] }, { char: 'ã·', roma: ['pu'] }, { char: 'ãº', roma: ['pe'] }, { char: 'ã½', roma: ['po'] }
            ];
            const dakuonKatakana = [
                { char: 'ã‚¬', roma: ['ga'] }, { char: 'ã‚®', roma: ['gi'] }, { char: 'ã‚°', roma: ['gu'] }, { char: 'ã‚²', roma: ['ge'] }, { char: 'ã‚´', roma: ['go'] },
                { char: 'ã‚¶', roma: ['za'] }, { char: 'ã‚¸', roma: ['ji', 'zi'] }, { char: 'ã‚º', roma: ['zu'] }, { char: 'ã‚¼', roma: ['ze'] }, { char: 'ã‚¾', roma: ['zo'] },
                { char: 'ãƒ€', roma: ['da'] }, { char: 'ãƒ‚', roma: ['ji', 'di'] }, { char: 'ãƒ…', roma: ['zu', 'du'] }, { char: 'ãƒ‡', roma: ['de'] }, { char: 'ãƒ‰', roma: ['do'] },
                { char: 'ãƒ', roma: ['ba'] }, { char: 'ãƒ“', roma: ['bi'] }, { char: 'ãƒ–', roma: ['bu'] }, { char: 'ãƒ™', roma: ['be'] }, { char: 'ãƒœ', roma: ['bo'] },
                { char: 'ãƒ‘', roma: ['pa'] }, { char: 'ãƒ”', roma: ['pi'] }, { char: 'ãƒ—', roma: ['pu'] }, { char: 'ãƒš', roma: ['pe'] }, { char: 'ãƒ', roma: ['po'] }
            ];

            const youonHiragana = [
                { char: 'ãã‚ƒ', roma: ['kya'] }, { char: 'ãã‚…', roma: ['kyu'] }, { char: 'ãã‚‡', roma: ['kyo'] },
                { char: 'ã—ã‚ƒ', roma: ['sha', 'sya'] }, { char: 'ã—ã‚…', roma: ['shu', 'syu'] }, { char: 'ã—ã‚‡', roma: ['sho', 'syo'] },
                { char: 'ã¡ã‚ƒ', roma: ['cha', 'tya'] }, { char: 'ã¡ã‚…', roma: ['chu', 'tyu'] }, { char: 'ã¡ã‚‡', roma: ['cho', 'tyo'] },
                { char: 'ã«ã‚ƒ', roma: ['nya'] }, { char: 'ã«ã‚…', roma: ['nyu'] }, { char: 'ã«ã‚‡', roma: ['nyo'] },
                { char: 'ã²ã‚ƒ', roma: ['hya'] }, { char: 'ã²ã‚…', roma: ['hyu'] }, { char: 'ã²ã‚‡', roma: ['hyo'] },
                { char: 'ã¿ã‚ƒ', roma: ['mya'] }, { char: 'ã¿ã‚…', roma: ['myu'] }, { char: 'ã¿ã‚‡', roma: ['myo'] },
                { char: 'ã‚Šã‚ƒ', roma: ['rya'] }, { char: 'ã‚Šã‚…', roma: ['ryu'] }, { char: 'ã‚Šã‚‡', roma: ['ryo'] },
                { char: 'ãã‚ƒ', roma: ['gya'] }, { char: 'ãã‚…', roma: ['gyu'] }, { char: 'ãã‚‡', roma: ['gyo'] },
                { char: 'ã˜ã‚ƒ', roma: ['ja', 'jya', 'zya'] }, { char: 'ã˜ã‚…', roma: ['ju', 'jyu', 'zyu'] }, { char: 'ã˜ã‚‡', roma: ['jo', 'jyo', 'zyo'] },
                { char: 'ã³ã‚ƒ', roma: ['bya'] }, { char: 'ã³ã‚…', roma: ['byu'] }, { char: 'ã³ã‚‡', roma: ['byo'] },
                { char: 'ã´ã‚ƒ', roma: ['pya'] }, { char: 'ã´ã‚…', roma: ['pyu'] }, { char: 'ã´ã‚‡', roma: ['pyo'] }
            ];
            const youonKatakana = [
                { char: 'ã‚­ãƒ£', roma: ['kya'] }, { char: 'ã‚­ãƒ¥', roma: ['kyu'] }, { char: 'ã‚­ãƒ§', roma: ['kyo'] },
                { char: 'ã‚·ãƒ£', roma: ['sha', 'sya'] }, { char: 'ã‚·ãƒ¥', roma: ['shu', 'syu'] }, { char: 'ã‚·ãƒ§', roma: ['sho', 'syo'] },
                { char: 'ãƒãƒ£', roma: ['cha', 'tya'] }, { char: 'ãƒãƒ¥', roma: ['chu', 'tyu'] }, { char: 'ãƒãƒ§', roma: ['cho', 'tyo'] },
                { char: 'ãƒ‹ãƒ£', roma: ['nya'] }, { char: 'ãƒ‹ãƒ¥', roma: ['nyu'] }, { char: 'ãƒ‹ãƒ§', roma: ['nyo'] },
                { char: 'ãƒ’ãƒ£', roma: ['hya'] }, { char: 'ãƒ’ãƒ¥', roma: ['hyu'] }, { char: 'ãƒ’ãƒ§', roma: ['hyo'] },
                { char: 'ãƒŸãƒ£', roma: ['mya'] }, { char: 'ãƒŸãƒ¥', roma: ['myu'] }, { char: 'ãƒŸãƒ§', roma: ['myo'] },
                { char: 'ãƒªãƒ£', roma: ['rya'] }, { char: 'ãƒªãƒ¥', roma: ['ryu'] }, { char: 'ãƒªãƒ§', roma: ['ryo'] },
                { char: 'ã‚®ãƒ£', roma: ['gya'] }, { char: 'ã‚®ãƒ¥', roma: ['gyu'] }, { char: 'ã‚®ãƒ§', roma: ['gyo'] },
                { char: 'ã‚¸ãƒ£', roma: ['ja', 'jya', 'zya'] }, { char: 'ã‚¸ãƒ¥', roma: ['ju', 'jyu', 'zyu'] }, { char: 'ã‚¸ãƒ§', roma: ['jo', 'jyo', 'zyo'] },
                { char: 'ãƒ“ãƒ£', roma: ['bya'] }, { char: 'ãƒ“ãƒ¥', roma: ['byu'] }, { char: 'ãƒ“ãƒ§', roma: ['byo'] },
                { char: 'ãƒ”ãƒ£', roma: ['pya'] }, { char: 'ãƒ”ãƒ¥', roma: ['pyu'] }, { char: 'ãƒ”ãƒ§', roma: ['pyo'] }
            ];

            // æ„å»ºé…å¯¹æ•°ç»„
            const seionPairs = seionHiragana.map((h, idx) => ({
                hira: h.char,
                kata: seionKatakana[idx].char,
                roma: h.roma[0]
            }));

            const dakuonPairs = dakuonHiragana.map((h, idx) => ({
                hira: h.char,
                kata: dakuonKatakana[idx].char,
                roma: h.roma[0]
            }));

            const youonPairs = youonHiragana.map((h, idx) => ({
                hira: h.char,
                kata: youonKatakana[idx].char,
                roma: h.roma[0]
            }));

            const SEION = [...seionHiragana, ...seionKatakana];
            const DAKUON = [...dakuonHiragana, ...dakuonKatakana];
            const YOUON = [...youonHiragana, ...youonKatakana];

            const LIBRARY = {
                seion: SEION,
                dakuon: [...SEION, ...DAKUON],
                youon: [...SEION, ...DAKUON, ...YOUON]
            };

            // ---------- DOM ----------
            const wordSelector = document.getElementById('wordSelector');
            const kanaDisplay = document.getElementById('kanaDisplay');
            const romajiInput = document.getElementById('romajiInput');
            const confirmBtn = document.getElementById('confirmBtn');
            const resultMessage = document.getElementById('resultMessage');
            const perfectSpan = document.getElementById('perfectCount');
            const goodSpan = document.getElementById('goodCount');
            const badSpan = document.getElementById('badCount');
            const feedbackList = document.getElementById('feedbackList');
            const clearFeedbackBtn = document.getElementById('clearFeedbackBtn');
            const endPracticeBtn = document.getElementById('endPracticeBtn');
            const timerDisplay = document.getElementById('timerDisplay');
            const learnBtn = document.getElementById('learnBtn');
            const learningSection = document.getElementById('learningSection');
            const seionPart = document.getElementById('seionPart');
            const dakuonPart = document.getElementById('dakuonPart');
            const youonPart = document.getElementById('youonPart');

            // ---------- å…¨å±€çŠ¶æ€ ----------
            let currentKana = { char: 'ã‚', roma: ['a'] };
            let perfect = 0, good = 0, bad = 0;
            const charStats = new Map();
            const errorChars = new Set();
            let remainingChars = [];
            let currentLibrary = SEION;

            let timerInterval = null;
            let timeoutId = null;
            let isTimeout = false;
            const INIT_TIME = 3;

            // ---------- å­¦ä¹ åŒºæ¸²æŸ“ ----------
            function renderLearningSection() {
                seionPart.innerHTML = '<div class="part-title">æ¸…éŸ³</div><div class="kana-rows" id="seionRows"></div>';
                const seionRows = document.getElementById('seionRows');
                seionPairs.forEach(p => {
                    const row = document.createElement('div');
                    row.className = 'kana-row';
                    if (errorChars.has(p.hira) || errorChars.has(p.kata)) {
                        row.classList.add('highlight');
                    }
                    row.innerHTML = `
                        <span class="hira">${p.hira}</span>
                        <span class="kata">${p.kata}</span>
                        <span class="roma">${p.roma}</span>
                    `;
                    seionRows.appendChild(row);
                });

                dakuonPart.innerHTML = '<div class="part-title">æµŠéŸ³ / åŠæµŠéŸ³</div><div class="kana-rows" id="dakuonRows"></div>';
                const dakuonRows = document.getElementById('dakuonRows');
                dakuonPairs.forEach(p => {
                    const row = document.createElement('div');
                    row.className = 'kana-row';
                    if (errorChars.has(p.hira) || errorChars.has(p.kata)) {
                        row.classList.add('highlight');
                    }
                    row.innerHTML = `
                        <span class="hira">${p.hira}</span>
                        <span class="kata">${p.kata}</span>
                        <span class="roma">${p.roma}</span>
                    `;
                    dakuonRows.appendChild(row);
                });

                youonPart.innerHTML = '<div class="part-title">æ‹—éŸ³</div><div class="kana-rows" id="youonRows"></div>';
                const youonRows = document.getElementById('youonRows');
                youonPairs.forEach(p => {
                    const row = document.createElement('div');
                    row.className = 'kana-row';
                    if (errorChars.has(p.hira) || errorChars.has(p.kata)) {
                        row.classList.add('highlight');
                    }
                    row.innerHTML = `
                        <span class="hira">${p.hira}</span>
                        <span class="kata">${p.kata}</span>
                        <span class="roma">${p.roma}</span>
                    `;
                    youonRows.appendChild(row);
                });
            }
            renderLearningSection();

            learnBtn.addEventListener('click', () => {
                learningSection.classList.toggle('visible');
            });

            // ---------- è¾…åŠ©å‡½æ•° ----------
            function shuffleArray(arr) {
                const copy = [...arr];
                for (let i = copy.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [copy[i], copy[j]] = [copy[j], copy[i]];
                }
                return copy;
            }

            function resetRemainingChars() {
                remainingChars = shuffleArray(currentLibrary);
            }

            function getNextKana() {
                if (remainingChars.length === 0) resetRemainingChars();
                return remainingChars.shift();
            }

            function stopTimer() {
                if (timerInterval) clearInterval(timerInterval);
                if (timeoutId) clearTimeout(timeoutId);
                timerInterval = null;
                timeoutId = null;
            }

            function startTimer() {
                stopTimer();
                isTimeout = false;
                let remainingTime = INIT_TIME;
                timerDisplay.textContent = remainingTime + 's';

                timerInterval = setInterval(() => {
                    remainingTime -= 1;
                    timerDisplay.textContent = remainingTime + 's';
                    if (remainingTime <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        isTimeout = true;
                        timerDisplay.textContent = '0s';
                    }
                }, 1000);

                timeoutId = setTimeout(() => {
                    isTimeout = true;
                    if (timerInterval) clearInterval(timerInterval);
                    timerInterval = null;
                    timerDisplay.textContent = '0s';
                }, 3000);
            }

            function setNewKana() {
                currentKana = getNextKana();
                kanaDisplay.textContent = currentKana.char;
                startTimer();
            }

            function isAnswerCorrect(input, kanaObj) {
                const cleanInput = input.toLowerCase().trim().replace(/\s+/g, '');
                if (cleanInput === '') return false;
                return kanaObj.roma.some(rom => rom.toLowerCase() === cleanInput);
            }

            function updateCounters() {
                perfectSpan.textContent = perfect;
                goodSpan.textContent = good;
                badSpan.textContent = bad;
            }

            function updateCharStats(char, isCorrect) {
                if (!charStats.has(char)) {
                    charStats.set(char, { correct: 0, wrong: 0 });
                }
                const stat = charStats.get(char);
                if (isCorrect) stat.correct += 1;
                else stat.wrong += 1;
            }

            function addErrorRecord(char, correctRoma) {
                errorChars.add(char);
                const badge = document.createElement('div');
                badge.className = 'badge-error';
                badge.textContent = `${char} (${correctRoma})`;
                const mark = document.createElement('span');
                mark.textContent = 'âœ˜';
                badge.appendChild(mark);
                feedbackList.appendChild(badge);
                feedbackList.scrollTop = feedbackList.scrollHeight;
                renderLearningSection();
            }

            function clearFeedback() {
                feedbackList.innerHTML = '';
                errorChars.clear();
                renderLearningSection();
            }

            function showErrorSummaryAndReset() {
                const errorEntries = [];
                for (let [char, stat] of charStats.entries()) {
                    if (stat.wrong > 0) {
                        errorEntries.push({ char, wrong: stat.wrong });
                    }
                }

                if (errorEntries.length === 0) {
                    alert('âœ¨ å¤ªæ£’äº†ï¼æ²¡æœ‰é”™è¯¯è®°å½• âœ¨');
                } else {
                    errorEntries.sort((a, b) => b.wrong - a.wrong);
                    let message = 'ğŸ“› é”™è¯¯å­—ç¬¦è®°å½• ğŸ“›\n\n';
                    errorEntries.forEach(item => {
                        message += `${item.char} : é”™è¯¯ ${item.wrong} æ¬¡\n`;
                    });
                    alert(message);
                }

                perfect = 0;
                good = 0;
                bad = 0;
                updateCounters();
                charStats.clear();
            }

            function handleAnswer() {
                const userInput = romajiInput.value;
                const isCorrect = isAnswerCorrect(userInput, currentKana);

                if (isCorrect) {
                    if (isTimeout) {
                        good++;
                        resultMessage.textContent = 'âœ… è‰¯å¥½ (G)';
                        resultMessage.style.color = '#b45b0f';
                    } else {
                        perfect++;
                        resultMessage.textContent = 'âœ… å®Œç¾ (P)';
                        resultMessage.style.color = '#1c7e4c';
                    }
                    updateCharStats(currentKana.char, true);
                } else {
                    bad++;
                    resultMessage.textContent = 'âŒ é”™è¯¯ (B)';
                    resultMessage.style.color = '#c92a2a';
                    addErrorRecord(currentKana.char, currentKana.roma[0]);
                    updateCharStats(currentKana.char, false);
                }

                updateCounters();
                romajiInput.value = '';
                romajiInput.focus();
                stopTimer();
                setNewKana();
            }

            function resetPractice(newLibrary) {
                currentLibrary = newLibrary;
                perfect = 0; good = 0; bad = 0;
                updateCounters();
                charStats.clear();
                clearFeedback();
                resultMessage.textContent = 'âœ¨ è¾“å…¥ç½—é©¬éŸ³ âœ¨';
                resultMessage.style.color = '#2b3a4a';
                resetRemainingChars();
                setNewKana();
            }

            // ---------- åˆå§‹åŒ– ----------
            function init() {
                currentLibrary = SEION;
                resetPractice(currentLibrary);

                confirmBtn.addEventListener('click', handleAnswer);
                romajiInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleAnswer();
                    }
                });
                clearFeedbackBtn.addEventListener('click', clearFeedback);
                endPracticeBtn.addEventListener('click', showErrorSummaryAndReset);

                wordSelector.addEventListener('change', (e) => {
                    const lib = e.target.value;
                    let newLib;
                    if (lib === 'seion') newLib = SEION;
                    else if (lib === 'dakuon') newLib = [...SEION, ...DAKUON];
                    else newLib = [...SEION, ...DAKUON, ...YOUON];
                    resetPractice(newLib);
                });
            }

            init();
        })();
    </script>
</body>
</html>
